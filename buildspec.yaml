version: 0.2

phases:
  pre_build:
    commands:
      - docker login --username AWS --password eyJwYXlsb2FkIjoicWdDQVBiNFRldFRsbmF3Z3kxLzZEL3JpRkI0YlVNbCtzZFQ2SGlJTjJxQ01VQ0VVUXZsclluN1BsNGVlOXBBb01oa1FCdTdxblhJR09iRVY1YzVBZ2Mrc21jV25OUGY1WkdqNS83YVNyb2YwL0NHdW1yd2xwbHc3TDRoM1FmSmhEZzQ0bTQxUlRteWF4YzN1bnZ4Sk9ZdFY0K2lUU0Z6cmZZeHhteGR3NytJd1NiTnRETTRsZjRBa1l4cDVFTU1uMUI3TWkrdG1zZEdrYlR0eWw4dHMzaTNpRDlyQmg0ZXpyM0I5SnlzNk9VYXBLMUgrRFl1cHFWbUNTb2ptaWROS291cmV4TGNMYWNFazFmeHk5THErajg2eTNOb2I0MmdkQUdqZnBGbG10dlhkUE9Yd25tYktMVmVEbHB3QjlIaVFJSDJjZkovdVoxcjUxdWQ2UjhMVFNtYjZRRnREekJXbFl5bjJ3eHB3NER2Z3dvVkNpdUxScW1ub3I0TmxMMUZvRDgzQWJiTmEvdkZVV2V0eDF0WlUwWEY0eitnbzFjQlhwRzBtSGpkN2Iwa2x0S1RnQTkzQXNSSFVqcGlETXVreDJ0VXg2VlZCZmtjQmowUXdFaFNMU3VDN2tOeXVlSzB2SDg0K01uRHNBZVB3K3JvUkpMS1NoVndKSzdUd3BkY2pxdmQ0dWQwUjVRRjRiT2Q3a1dCc0NWMk5DVWowdHlHeUhJUEVTeEk3bklIcWtJNHNPbEFDUjloWVZKU241Qk9wYU9Kd2Fqc2VjamE3TWtHK2cvbzQ2SVZScVB5MnlzVzlNREtVbFd4WTJOMzlna1VCTG93QnB4cW85S2cvQnZIR05pM3Z0WXdZaW5ZOC9KVzZzUjlmMVBUeHN4RGRTdUFlYVl2TVRmRUR4SThpOEh1Ry9VLzgwQktrbmUyZEppeDNEU3QxdE9TMjhPcTV5VnBuTlEzaGZreDJESVFoblk4SXFxRXJQOHRmcStzeXFPZUZJZS9VdFU0MVYwMjJLNi83VVdFcjRudjZ3Wk9veTRzQzJpZHRQdmJsYTJqazFVZTNJbVhESHpLekI2OHd1WStXV09WSjFJN2dPNEwwY2VhNjU2d1FkSmdhMUhMZVlzbk1mNGVHU3dZUVdFcU5CKzA5Ky8zekQyWGNOcHlBcG55MW5qb0hkM0JuMldFbi82L2RUZkxNOHh6TGZpREluT3l0THpsUW1DRGIvK0FXUzdxaDlzYVp1cDd6MFJTL0dSSnlJSDM1NENHbkxxVE9Hb0VMcE9yRzUxUWlGaTBzb3dJVmNNLys4Q0gxM2NCUTc5YXRlbFl3YnVrPSIsImRhdGFrZXkiOiJBUUlCQUhoZnJGUTJhSUl3RjVWYzc5UkhFUEduY1VXdXIyL0p6TTh0L1p6b0V0UnJBZ0VncDNSUFpnaU0wWDVCUUg2YTUyaDJBQUFBZmpCOEJna3Foa2lHOXcwQkJ3YWdiekJ0QWdFQU1HZ0dDU3FHU0liM0RRRUhBVEFlQmdsZ2hrZ0JaUU1FQVM0d0VRUU1BQWJlcElsTzZ0NDB6U29QQWdFUWdEc2hHRy9nbDJGRVlWb3ZoVXdtdU9mRlFSWmNBRVFBd1BmdFpJSGhBa3ZWL1FOLzFrSktOMVIxWndrRWYrOERzbXVjU29FcHNlbXBSajZhZ3c9PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTc0ODQyNjYyM30= 512233056251.dkr.ecr.eu-north-1.amazonaws.com
  build:
    commands:
      - docker build -t reservations -f apps/reservations/Dockerfile .
      - docker tag reservations:latest 512233056251.dkr.ecr.eu-north-1.amazonaws.com/reservations:latest

      - docker build -t auth -f apps/auth/Dockerfile .
      - docker tag auth:latest 512233056251.dkr.ecr.eu-north-1.amazonaws.com/auth:latest

      - docker build -t payments -f apps/payments/Dockerfile .
      - docker tag payments:latest 512233056251.dkr.ecr.eu-north-1.amazonaws.com/payments:latest

      - docker build -t notifications -f apps/notifications/Dockerfile .
      - docker tag notifications:latest 512233056251.dkr.ecr.eu-north-1.amazonaws.com/notifications:latest
  post_build:
    commands:
      - docker push 512233056251.dkr.ecr.eu-north-1.amazonaws.com/reservations:latest
      - docker push 512233056251.dkr.ecr.eu-north-1.amazonaws.com/auth:latest
      - docker push 512233056251.dkr.ecr.eu-north-1.amazonaws.com/payments:latest
      - docker push 512233056251.dkr.ecr.eu-north-1.amazonaws.com/notifications:latest
